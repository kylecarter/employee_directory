var EmployeeDirectory;EmployeeDirectory=function(){var a,b,c,d;return b=new Object,d=function(a){$(document).ready(function(){EmployeeDirectory.utils.handleHashValues(a)})},c=function(){b={status:EmployeeDirectory.utils.getLoginStatus(),anchor:EmployeeDirectory.utils.getAppState()},EmployeeDirectory.utils.handleHashValues(b)},a=function(){b={status:EmployeeDirectory.utils.getLoginStatus(),anchor:EmployeeDirectory.utils.getAppState()},this.container=$("#application-data"),d(b),$(window).on("hashchange",function(){c()})},{initApp:a}}(),EmployeeDirectory.utils=function(){"use strict";var a,b,c,d,e,f,g;return a={params:null},f=function(b){a.params=b},c=function(){var a;return a=null!=$.cookie("loggedin")&&"no"!==$.cookie("loggedin")?!0:!1},b=function(){var a;return a=$.uriAnchor.makeAnchorMap()},g=function(){return $(".spinner").show()},e=function(){return $(".spinner").hide()},d=function(b){var c,d;c=$("#content"),d={reset:function(){return c.hasClass("reset-pswrd")?!1:void EmployeeDirectory.reset.configModule()},employee:function(){return c.hasClass("usr-profile")?!1:void EmployeeDirectory.employee.configModule(a.params)},p404:function(){return c.hasClass("notfound")?!1:void EmployeeDirectory.notfound.configModule()},signin:function(){return c.hasClass("loggedout")?!1:void EmployeeDirectory.login.configModule()}},b.status&&"employee"===b.anchor.page&&d.employee(),"reset"===b.anchor.page?($.cookie("loggined","no"),$.removeCookie("user"),d.reset()):"p404"===b.anchor.page?($.cookie("loggined","no"),$.removeCookie("user"),d.p404()):($.cookie("loggined","no"),$.removeCookie("user"),d.signin())},{setData:f,getLoginStatus:c,getAppState:b,showLoading:g,hideLoading:e,handleHashValues:d}}(),EmployeeDirectory.create=function(){"use strict";var a,b;return a={templates:{appendEmployee:EmployeeDirectoryViews["hbs/NewEmployee.hbs"]}},b=function(b,c,d){var e,f;f="/user/create?";for(e in b)f+=e+"="+b[e]+"&";f+="admin=false",console.log(f),$.ajax({url:"/user/create?"+f,dataType:"json",type:"POST",success:function(e){console.log(e),c.find(".modal-body").append('<p class="msg">New employee added.</p>'),b.curprofile=d,$("#employee-list").append(a.templates.appendEmployee(b))},error:function(a,b,d){console.log(a,b,d),c.find(".modal-body").append('<p class="msg">There was a problem processing your request. Please try again later.</p>')}})},{doAddEmployee:b}}(),EmployeeDirectory["delete"]=function(){"use strict";var a;return a=function(a,b){$.ajax({url:"/user/delete/"+a,dataType:"json",type:"GET",success:function(a){b.remove()},error:function(a,b,c){console.log(a,b,c),window.alert("We are having difficulty processing your request please try again later.")}})},{doDeleteEmployee:a}}(),EmployeeDirectory.read=function(){"use strict";var a,b,c,d,e,f,g;return a={params:null,templates:{employeeslist:EmployeeDirectoryViews["hbs/EmployeeList.hbs"]}},e=function(b){a.params=b},g=function(a,b){var c,d;for(c=0,d=!1;c<user.length;){if(a===user[c].email&&b===user[c].password){d=user[c];break}c++}return d},f=function(b){return $.ajax({url:"/user/read/"+b,dataType:"json",type:"GET",success:function(a){a.length>0?($.uriAnchor.setAnchor({page:"employee",_page:{id:a[0].employee_id}}),e(a[0])):$.uriAnchor.setAnchor({page:"p404"})},error:function(a,b,c){console.log(a,b,c),$.uriAnchor.setAnchor({page:"p404"})}}),a.params},c=function(a,b){$.ajax({url:"/user/login?usr="+a.val()+"&pswrd="+b.val(),dataType:"json",type:"POST",success:function(a){a.length>0?($.uriAnchor.setAnchor({page:"employee",_page:{id:a[0].employee_id}}),$.cookie("loggedin","yes"),$.cookie("user",a[0].employee_id),EmployeeDirectory.utils.setData(a[0])):EmployeeDirectory.notfound.configModule({})},error:function(a,b,c){console.log(a,b,c),$.removeCookie("loggedin"),$.removeCookie("user"),form.after('<div class="container-fluid"><div class="col-sm-12"><p style="margin-top: 18px; font-size: 0.775em;">The information provided does not match a known employee. Please check the information you entered and try again. If you contine to have problems contact IT.</p></div></div>')}})},d=function(){$.uriAnchor.setAnchor({page:"signin"}),$.removeCookie("loggedin"),$.removeCookie("user")},b=function(b,c){$.ajax({url:"/user/read",dataType:"json",type:"GET",success:function(d){var e;e=new Object,e.curadmin="true"===c?!0:!1,e.size=d.length,e.employee=d,b.html(function(b,c){return a.templates.employeeslist(e)}),EmployeeDirectory.employee.initModule()},error:function(a,c,d){console.log(a,c,d),b.html(function(a,b){return"<li>We are experiencing some difficulties processing your request. Please try again later.</li>"})}})},{verifyUser:g,validateUser:f,doLogIn:c,doLogOut:d,doListEmployees:b}}(),EmployeeDirectory.update=function(){"use strict";var a,b,c;return b=function(a,b,c){$.ajax({url:"/user/updatepw/"+b+"?pswrd="+a,dataType:"json",type:"POST",success:function(a){c.find(".msg").length>0?c.find(".msg").html("Your password has been updated."):c.find(".modal-body").append('<p class="msg">Your password has been updated.</p>')},error:function(a,b,d){console.log(a,b,d),c.find(".msg").length>0?c.find(".msg").html("There was a problem processing your request. Please try again later."):c.find(".modal-body").append('<p class="msg">There was a problem processing your request. Please try again later.</p>')}})},a=function(a,b,c){$.ajax({url:"/user/avatar/"+b+"?graphic="+a,dataType:"json",type:"POST",success:function(b){c.find(".msg").length>0?c.find(".msg").html("Your avatar has been updated."):c.find(".modal-body").append('<p class="msg">Your avatar has been updated.</p>'),$("#avatar").find("img")>0?$("#avatar img").attr("src",a):$("#avatar").html('<img src="'+a+'" alt="profile photo">')},error:function(a,b,d){console.log(a,b,d),c.find(".msg").length>0?c.find(".msg").html("There was a problem processing your request. Please try again later."):c.find(".modal-body").append('<p class="msg">There was a problem processing your request. Please try again later.</p>')}})},c=function(a,b){$.ajax({url:"/user/role/"+a,dataType:"json",type:"POST",success:function(a){b.attr("disabled","disabled")},error:function(a,b,c){console.log(a,b,c),window.alert("We are having difficulty processing your request please try again later.")}})},{doChangePassword:b,doChangeAvatar:a,doMakeAdmin:c}}(),EmployeeDirectory.employee=function(){"use strict";var a,b,c,d,e,f,g,h,i,j;return a={params:null,templates:{shell:EmployeeDirectoryViews["hbs/UserProfile.hbs"],results:EmployeeDirectoryViews["hbs/SearchResults.hbs"],notfound:EmployeeDirectoryViews["hbs/EmployeeNotFound.hbs"],changepswrd:EmployeeDirectoryViews["hbs/ChangePassword.hbs"],changeavtr:EmployeeDirectoryViews["hbs/ChangeAvatar.hbs"],addemployee:EmployeeDirectoryViews["hbs/AddEmployee.hbs"]}},j={status:EmployeeDirectory.utils.getLoginStatus(),anchor:EmployeeDirectory.utils.getAppState()},b=function(b){console.log(b),a.params=void 0===b||null===b?EmployeeDirectory.read.validateUser(b):b,a.params?(EmployeeDirectory.container.html(function(b,c){return a.templates.shell(a.params)}),EmployeeDirectory.read.doListEmployees($("#wrapper"),$("#content").attr("data-admin"))):($.uriAnchor.setAnchor({page:"p404"}),$.removeCookie("loggedin"),$.removeCookie("user"))},h=function(b){b.on("click touchend",function(){var b;$("#myModal").html(a.templates.changepswrd({})),b=$("#ChangePassword"),b.validate({rules:{old:{required:!0},diffrnt:{required:!0},confirm:{required:!0}},messages:{old:"You must enter your old password.",diffrnt:"You must enter a value that does not equal your old passord.",confirm:"Verify you entered the same value as the new password."},validClass:"has-success control-label",errorClass:"has-error control-label",highlight:function(a,b,c){$(a).parent(".form-group").addClass("has-error").removeClass("has-success")},unhighlight:function(a,b,c){$(a).parent(".form-group").addClass("has-success").removeClass("has-error")}}),$("#ChangePassword .btn-primary").on("click touchend",function(){var a,c,d;b.valid()&&(d=$("#old").val(),a=$("#confirm").val(),c=$("#diffrnt").val(),a===c?a!==d&&c!==d?EmployeeDirectory.update.doChangePassword(a,$(".usr-profile").attr("data-id"),b):b.find(".modal-body").append('<p class="msg">Your new password cannot be set to your old password.</p>'):b.find(".modal-body").append('<p class="msg">The new password and confirm password must match.</p>'))})})},d=function(b){b.on("click touchend",function(){var b;$("#myModal").html(a.templates.changeavtr({})),b=$("#ChangeAvatar"),b.validate({rules:{"upload-avatar":{required:!0,url:!0}},messages:{"upload-avatar":"You must enter a valid URL."},validClass:"has-success control-label",errorClass:"has-error control-label",highlight:function(a,b,c){$(a).parent(".form-group").addClass("has-error").removeClass("has-success")},unhighlight:function(a,b,c){$(a).parent(".form-group").addClass("has-success").removeClass("has-error")}}),$("#ChangeAvatar .btn-primary").on("click touchend",function(){b.valid()&&EmployeeDirectory.update.doChangeAvatar($("#upload-avatar").val(),$(".usr-profile").attr("data-id"),b)})})},f=function(a){a.on("click touchend",function(){EmployeeDirectory.read.doLogOut()})},g=function(a){a.each(function(){var a;a=$(this),a.on("click touchend",function(){EmployeeDirectory.update.doMakeAdmin(a.parents("li").attr("data-db"),a)})})},e=function(a){a.each(function(){var a;a=$(this),a.on("click touchend",function(){window.confirm("Are you sure you want to delete this employee? This action cannot be undone.")&&EmployeeDirectory["delete"].doDeleteEmployee(a.parents("li").attr("data-db"),a.parents("li"))})})},c=function(b){b.on("click touchend",function(){var b;$("#myModal").html(a.templates.addemployee({})),b=$("#AddEmployee"),b.validate({rules:{"new-fname":{required:!0},"new-lname":{required:!0},"job-title":{required:!0},"new-email":{required:!0,email:!0}},messages:{"new-fname":"Employee first name is required","new-lname":"Employee last name is required","job-title":"Employee job title is required","new-email":"A valid employee email address is required"},validClass:"has-success control-label",errorClass:"has-error control-label",highlight:function(a,b,c){$(a).parent(".form-group").addClass("has-error").removeClass("has-success")},unhighlight:function(a,b,c){$(a).parent(".form-group").addClass("has-success").removeClass("has-error")}}),$("#AddEmployee .btn-primary").on("click touchend",function(){var a;b.valid()&&(a={first_name:$("#new-fname").val(),last_name:$("#new-lname").val(),title:$("#job-title").val(),street_address:$("#street").val(),street_address_addtnal:$("#street2").val(),city:$("#city").val(),state:$("#state").val(),zip:$("#zip").val(),phone:$("#new-phone").val(),email:$("#new-email").val()},EmployeeDirectory.create.doAddEmployee(a,b,$(".usr-profile").attr("data-admin")))})})},i=function(){f($("#loggout")),h($("#change-pswrd.js-modal-trigger")),d($("#update-profile.js-modal-trigger")),c($("#employee-add .js-modal-trigger")),g($(".js-trigger-admin")),e($(".js-trigger-delete"))},{configModule:b,initModule:i}}(),EmployeeDirectory.login=function(){"use strict";var a,b,c,d,e,f;return a={params:null,templates:{login:EmployeeDirectoryViews["hbs/LoggedOut.hbs"]}},f={status:EmployeeDirectory.utils.getLoginStatus(),anchor:EmployeeDirectory.utils.getAppState()},b=function(){EmployeeDirectory.container.html(function(b,c){return a.templates.login({})}),d()},d=function(){e($("#log-in"),$("#login-submit")),c($("#forgot"))},e=function(a,b){a.validate({rules:{user:{required:!0},password:{required:!0}},messages:{user:"Verify your user name is accurate.",password:"If you are having trouble with your password, you can request to change it."},validClass:"has-success control-label",errorClass:"has-error control-label",highlight:function(a,b,c){$(a).parent(".log-in__cmnpt").addClass("has-error").removeClass("has-success")},unhighlight:function(a,b,c){$(a).parent(".log-in__cmnpt").addClass("has-success").removeClass("has-error")}}),b.on("click touchend",function(){a.valid()&&EmployeeDirectory.read.doLogIn($("#user"),$("#password"))})},c=function(a){a.on("click touchend",function(){$.uriAnchor.setAnchor({page:"reset"})})},{configModule:b}}(),EmployeeDirectory.notfound=function(){"use strict";var a,b,c,d,e;return a={params:null,templates:{notfound:EmployeeDirectoryViews["hbs/EmployeeNotFound.hbs"]}},e={status:EmployeeDirectory.utils.getLoginStatus(),anchor:EmployeeDirectory.utils.getAppState()},b=function(){EmployeeDirectory.container.html(function(b,c){return a.templates.notfound({})}),c()},c=function(){d($("#notfound"))},d=function(a){a.on("click touchend",function(){$.uriAnchor.setAnchor({page:"signin"})})},{configModule:b}}(),EmployeeDirectory.reset=function(){"use strict";var a,b,c,d,e,f;return a={params:null,templates:{reset:EmployeeDirectoryViews["hbs/ResetPsswrd.hbs"]}},f={status:EmployeeDirectory.utils.getLoginStatus(),anchor:EmployeeDirectory.utils.getAppState()},b=function(){EmployeeDirectory.container.html(function(b,c){return a.templates.reset({})}),c()},c=function(){d($("#reset"),$("#request-submit")),e($("#sign-in"))},d=function(a,b){a.validate({rules:{email:{required:!0}},messages:{user:"Verify your email address is accurate.",required:"A valid email address is needed to reset your password."},validClass:"has-success control-label",errorClass:"has-error control-label",highlight:function(a,b,c){$(a).parent(".log-in__cmnpt").addClass("has-error").removeClass("has-success")},unhighlight:function(a,b,c){$(a).parent(".log-in__cmnpt").addClass("has-success").removeClass("has-error")}}),b.on("click touchend",function(){var b;a.valid()&&(EmployeeDirectory.utils.showLoading(),b=window.setTimeout(function(){a.hide(),$("#request-sent").show(),EmployeeDirectory.utils.hideLoading(),window.clearTimeout(b)},900))})},e=function(a){a.on("click touchend",function(){$.uriAnchor.setAnchor({page:"signin"})})},{configModule:b}}(),EmployeeDirectory.shell=function(){var a,b;return b={status:EmployeeDirectory.utils.getLoginStatus(),anchor:EmployeeDirectory.utils.getAppState()},a=function(){EmployeeDirectory.utils.handleHashValues()},{initModule:a}}();